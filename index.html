
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiteStats</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: #333; /* Fallback color */
            background-image: url('https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #FFFFFF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(0,0,0,0.7);
            margin-bottom: 2rem;
        }

        .logo .fork {
            display: inline-block;
            transform: rotate(180deg);
            margin-right: -15px;
            color: #FF8C00;
        }

        .search-form {
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .search-input, .portion-input {
            padding: 1rem;
            border-radius: 50px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            transition: all 0.3s ease;
        }

        .search-input {
            width: 70%;
            border: 1px solid rgba(255, 218, 185, 0.5);
            background: rgba(88, 41, 0, 0.5); /* Earthy brown */
            color: #FFDAB9; /* PeachPuff */
        }

        .portion-input {
            width: 25%;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.4);
            color: white;
        }

        .search-input::placeholder, .portion-input::placeholder {
            color: rgba(255, 218, 185, 0.7);
        }

        .search-input:focus, .portion-input:focus {
            background: rgba(0, 0, 0, 0.5);
        }

        .pulse-animation {
            display: none;
            font-size: 1.2rem;
            color: #333333;
            animation: pulse 1.5s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .results-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            display: none; /* Initially hidden */
        }
        
        .results-content {
            color: #FFF0E1; /* Dutch White */
        }

        .results-content h2 {
            margin: 0;
            font-size: 1.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .verified-badge {
            font-size: 0.9rem;
            color: #28a745;
            display: none; /* Hidden by default */
            margin-top: 0.5rem;
        }

        .nutrition-info {
            display: flex;
            justify-content: space-around;
            margin-top: 1.5rem;
        }

        .nutrition-item {
            text-align: center;
        }

        .nutrition-item p {
            margin: 0;
            font-size: 1.2rem;
        }

        .nutrition-item .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-top: 0.5rem;
        }

        .calories {
            color: #FF8C00;
            text-shadow: 0 0 15px #FF8C00, 0 0 5px #FFFFFF;
        }

        .protein {
            color: #00BFFF;
            text-shadow: 0 0 15px #00BFFF, 0 0 5px #FFFFFF;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="logo">
            Bite<span class="fork">üç¥</span>Stats
        </div>
        <div class="search-form">
            <input type="text" class="search-input" id="searchInput" placeholder="e.g., 'sourdough bread' or 'eggs'">
            <input type="number" class="portion-input" id="portionInput" placeholder="Portion (g)">
        </div>

        <div class="pulse-animation" id="pulseAnimation">Searching...</div>

        <div class="results-card" id="resultsCard">
            <div class="results-content">
                <h2 id="foodQuery"></h2>
                <div class="verified-badge" id="verifiedBadge">‚úî Verified Source</div>
                <div class="nutrition-info">
                    <div class="nutrition-item">
                        <p>Estimated Calories</p>
                        <p class="value calories" id="caloriesValue">--</p>
                    </div>
                    <div class="nutrition-item">
                        <p>Estimated Protein</p>
                        <p class="value protein" id="proteinValue">--</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const portionInput = document.getElementById('portionInput');
        const pulseAnimation = document.getElementById('pulseAnimation');
        const resultsCard = document.getElementById('resultsCard');
        const foodQuery = document.getElementById('foodQuery');
        const caloriesValue = document.getElementById('caloriesValue');
        const proteinValue = document.getElementById('proteinValue');
        const verifiedBadge = document.getElementById('verifiedBadge');

        const fallbackData = {
            "apple": { calories: 52, protein: 0.3 },
            "banana": { calories: 89, protein: 1.1 },
            "egg": { calories: 155, protein: 13 },
            "chicken breast": { calories: 165, protein: 31 },
            "broccoli": { calories: 34, protein: 2.8 },
            "spinach": { calories: 23, protein: 2.9 },
            "salmon": { calories: 208, protein: 20 },
            "avocado": { calories: 160, protein: 2 },
            "brown rice": { calories: 111, protein: 2.6 },
            "almonds": { calories: 579, protein: 21 },
        };

        const debounce = (func, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        };

        const handleSearch = async () => {
            const query = searchInput.value.toLowerCase();
            const portion = parseFloat(portionInput.value) || 100;

            if (!query) {
                resultsCard.style.display = 'none';
                return;
            }

            pulseAnimation.style.display = 'block';
            resultsCard.style.display = 'none';
            verifiedBadge.style.display = 'none';

            try {
                // 1. Try OpenFoodFacts API
                const response = await fetch(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${query}&json=1`);
                const data = await response.json();

                if (data.products && data.products.length > 0) {
                    const product = data.products[0];
                    const calories_100g = product.nutriments['energy-kcal_100g'] || 0;
                    const protein_100g = product.nutriments.proteins_100g || 0;
                    
                    const finalCalories = (calories_100g / 100 * portion).toFixed(0);
                    const finalProtein = (protein_100g / 100 * portion).toFixed(1);

                    updateResults(query, finalCalories, finalProtein, true);
                    return;
                }

                // 2. Try Fallback Data
                const fallback = findFallback(query);
                if (fallback) {
                    const finalCalories = (fallback.calories / 100 * portion).toFixed(0);
                    const finalProtein = (fallback.protein / 100 * portion).toFixed(1);
                    updateResults(query, finalCalories, finalProtein, false);
                    return;
                }
                
                // 3. Not found
                showNotFound(query);

            } catch (error) {
                console.error("Error fetching nutrition data:", error);
                pulseAnimation.textContent = 'Sorry, something went wrong.';
            } finally {
                pulseAnimation.style.display = 'none';
            }
        };

        const findFallback = (query) => {
            const queryWords = query.split(' ');
            for (const key in fallbackData) {
                if (queryWords.some(word => key.includes(word))) {
                    return fallbackData[key];
                }
            }
            return null;
        };

        const updateResults = (query, calories, protein, isVerified) => {
            foodQuery.textContent = `${portionInput.value || '100'}g of ${query}`;
            caloriesValue.textContent = calories;
            proteinValue.textContent = `${protein}g`;
            verifiedBadge.style.display = isVerified ? 'block' : 'none';
            resultsCard.style.display = 'block';
        };
        
        const showNotFound = (query) => {
            foodQuery.textContent = `No results for "${query}"`;
            caloriesValue.textContent = '--';
            proteinValue.textContent = '--';
            verifiedBadge.style.display = 'none';
            resultsCard.style.display = 'block';
        };

        const debouncedSearch = debounce(handleSearch, 500);

        searchInput.addEventListener('input', debouncedSearch);
        portionInput.addEventListener('input', debouncedSearch);

    </script>

</body>
</html>
