
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiteStats</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-image-light: url('https://images.pexels.com/photos/1640777/pexels-photo-1640777.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            --bg-image-dark: url('https://images.pexels.com/photos/326281/pexels-photo-326281.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2');
            --bg-color: #333;
            --text-color: #FFFFFF;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.18);
            --input-bg: rgba(88, 41, 0, 0.5);
            --input-text: #FFDAB9;
            --input-border: rgba(255, 218, 185, 0.5);
            --fork-color: #FF8C00;
            --calories-color: #FF8C00;
            --protein-color: #00BFFF;
        }

        body {
            margin: 0;
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-color);
            background-image: var(--bg-image-light);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem;
            transition: background-image 0.5s ease-in-out;
        }

        body.dark-mode {
            background-image: var(--bg-image-dark);
            --card-bg: rgba(0, 0, 0, 0.5);
            --input-bg: rgba(50, 50, 50, 0.7);
            --input-text: #E0E0E0;
        }

        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        #languageSelector, #theme-toggle-button {
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid white;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .container {
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        .logo {
            font-size: 3.5rem;
            font-weight: 700;
            text-shadow: 0 0 15px rgba(0,0,0,0.7);
            margin-bottom: 2rem;
        }

        .logo .fork {
            display: inline-block;
            transform: rotate(180deg);
            margin-right: -15px;
            color: var(--fork-color);
        }

        .search-form {
            margin: 2rem 0;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .search-input, .portion-input {
            padding: 1rem;
            border-radius: 50px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            transition: all 0.3s ease;
            background: var(--input-bg);
            color: var(--input-text);
            border: 1px solid var(--input-border);
        }

        .search-input {
            width: 70%;
        }

        .portion-input {
            width: 25%;
        }

        .results-card {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid var(--card-border);
            display: none; 
        }
        
        .results-content {
            color: #FFF0E1; 
        }

        .calories {
            color: var(--calories-color);
            text-shadow: 0 0 15px var(--calories-color), 0 0 5px #FFFFFF;
        }

        .protein {
            color: var(--protein-color);
            text-shadow: 0 0 15px var(--protein-color), 0 0 5px #FFFFFF;
        }
    </style>
</head>
<body>
    <div class="header-controls">
        <select id="languageSelector"></select>
        <button id="theme-toggle-button" data-key="toggle_theme"></button>
    </div>

    <div class="container">
        <div class="logo">
            Bite<span class="fork">üç¥</span>Stats
        </div>
        <div class="search-form">
            <input type="text" class="search-input" id="searchInput" data-key="search_placeholder">
            <input type="number" class="portion-input" id="portionInput" data-key="portion_placeholder">
        </div>

        <div class="pulse-animation" id="pulseAnimation" data-key="searching"></div>

        <div class="results-card" id="resultsCard">
            <div class="results-content">
                <h2 id="foodQuery"></h2>
                <div class="verified-badge" id="verifiedBadge" data-key="verified_source"></div>
                <div class="nutrition-info">
                    <div class="nutrition-item">
                        <p data-key="calories_label"></p>
                        <p class="value calories" id="caloriesValue">--</p>
                    </div>
                    <div class="nutrition-item">
                        <p data-key="protein_label"></p>
                        <p class="value protein" id="proteinValue">--</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            en: { 
                search_placeholder: "e.g., 'sourdough bread' or 'eggs'", 
                portion_placeholder: "Portion (g)", 
                searching: "Searching...", 
                verified_source: "‚úî Verified Source", 
                calories_label: "Estimated Calories", 
                protein_label: "Estimated Protein",
                toggle_theme: "Toggle Theme"
            },
            zh: { 
                search_placeholder: "‰æãÂ¶ÇÔºö'ÈÖ∏Èù¢ÂåÖ'Êàñ'È∏°Ëõã'", 
                portion_placeholder: "‰ªΩÈáèÔºàÂÖãÔºâ", 
                searching: "Ê≠£Âú®ÊêúÁ¥¢...", 
                verified_source: "‚úî È™åËØÅÊù•Ê∫ê", 
                calories_label: "‰º∞ËÆ°Âç°Ë∑ØÈáå", 
                protein_label: "‰º∞ËÆ°ËõãÁôΩË¥®",
                toggle_theme: "ÂàáÊç¢‰∏ªÈ¢ò"
            },
            fr: { 
                search_placeholder: "Ex: 'pain au levain' ou '≈ìufs'", 
                portion_placeholder: "Portion (g)", 
                searching: "Recherche...", 
                verified_source: "‚úî Source V√©rifi√©e", 
                calories_label: "Calories Estim√©es", 
                protein_label: "Prot√©ines Estim√©es",
                toggle_theme: "Changer de th√®me"
            },
            ms: { 
                search_placeholder: "Cth: 'roti masam' atau 'telur'", 
                portion_placeholder: "Bahagian (g)", 
                searching: "Mencari...", 
                verified_source: "‚úî Sumber Disahkan", 
                calories_label: "Anggaran Kalori", 
                protein_label: "Anggaran Protein",
                toggle_theme: "Tukar Tema"
            },
        };

        const setLanguage = (lang) => {
            document.querySelectorAll("[data-key]").forEach(elem => {
                const key = elem.getAttribute("data-key");
                if (translations[lang] && translations[lang][key]) {
                    if (elem.tagName === 'INPUT') {
                        elem.placeholder = translations[lang][key];
                    } else {
                        elem.textContent = translations[lang][key];
                    }
                }
            });
            localStorage.setItem('language', lang);
        };

        const langSelector = document.getElementById('languageSelector');
        Object.keys(translations).forEach(lang => {
            const option = document.createElement('option');
            option.value = lang;
            option.textContent = lang.toUpperCase();
            langSelector.appendChild(option);
        });

        langSelector.addEventListener('change', (e) => setLanguage(e.target.value));

        // Set initial language
        const savedLang = localStorage.getItem('language') || 'en';
        langSelector.value = savedLang;
        setLanguage(savedLang);

        // --- Theme Toggle ---
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const body = document.body;

        const applyTheme = (theme) => {
            if (theme === 'dark') {
                body.classList.add('dark-mode');
            } else {
                body.classList.remove('dark-mode');
            }
            localStorage.setItem('theme', theme);
        }

        themeToggleButton.addEventListener('click', () => {
            const newTheme = body.classList.contains('dark-mode') ? 'light' : 'dark';
            applyTheme(newTheme);
        });
        
        // Set initial theme
        const savedTheme = localStorage.getItem('theme') || 'light';
        applyTheme(savedTheme);
        
        // --- Search Logic (from previous step, unchanged) ---
        const searchInput = document.getElementById('searchInput');
        const portionInput = document.getElementById('portionInput');
        const pulseAnimation = document.getElementById('pulseAnimation');
        const resultsCard = document.getElementById('resultsCard');
        const foodQuery = document.getElementById('foodQuery');
        const caloriesValue = document.getElementById('caloriesValue');
        const proteinValue = document.getElementById('proteinValue');
        const verifiedBadge = document.getElementById('verifiedBadge');

        const fallbackData = {
            "apple": { calories: 52, protein: 0.3 },
            "banana": { calories: 89, protein: 1.1 },
            "egg": { calories: 155, protein: 13 },
            "chicken breast": { calories: 165, protein: 31 },
            "broccoli": { calories: 34, protein: 2.8 },
            "spinach": { calories: 23, protein: 2.9 },
            "salmon": { calories: 208, protein: 20 },
            "avocado": { calories: 160, protein: 2 },
            "brown rice": { calories: 111, protein: 2.6 },
            "almonds": { calories: 579, protein: 21 },
        };

        const debounce = (func, delay) => {
            let timeoutId;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => {
                    func.apply(this, args);
                }, delay);
            };
        };

        const handleSearch = async () => {
            const query = searchInput.value.toLowerCase();
            const portion = parseFloat(portionInput.value) || 100;

            if (!query) {
                resultsCard.style.display = 'none';
                return;
            }

            pulseAnimation.style.display = 'block';
            resultsCard.style.display = 'none';
            verifiedBadge.style.display = 'none';

            try {
                const response = await fetch(`https://world.openfoodfacts.org/cgi/search.pl?search_terms=${query}&json=1`);
                const data = await response.json();

                if (data.products && data.products.length > 0) {
                    const product = data.products[0];
                    const calories_100g = product.nutriments['energy-kcal_100g'] || 0;
                    const protein_100g = product.nutriments.proteins_100g || 0;
                    
                    const finalCalories = (calories_100g / 100 * portion).toFixed(0);
                    const finalProtein = (protein_100g / 100 * portion).toFixed(1);

                    updateResults(query, finalCalories, finalProtein, true);
                    return;
                }

                const fallback = findFallback(query);
                if (fallback) {
                    const finalCalories = (fallback.calories / 100 * portion).toFixed(0);
                    const finalProtein = (fallback.protein / 100 * portion).toFixed(1);
                    updateResults(query, finalCalories, finalProtein, false);
                    return;
                }
                
                showNotFound(query);

            } catch (error) {
                console.error("Error fetching nutrition data:", error);
                pulseAnimation.textContent = 'Sorry, something went wrong.';
            } finally {
                pulseAnimation.style.display = 'none';
            }
        };

        const findFallback = (query) => {
            const queryWords = query.split(' ');
            for (const key in fallbackData) {
                if (queryWords.some(word => key.includes(word))) {
                    return fallbackData[key];
                }
            }
            return null;
        };

        const updateResults = (query, calories, protein, isVerified) => {
            foodQuery.textContent = `${portionInput.value || '100'}g of ${query}`;
            caloriesValue.textContent = calories;
            proteinValue.textContent = `${protein}g`;
            verifiedBadge.style.display = isVerified ? 'block' : 'none';
            resultsCard.style.display = 'block';
        };
        
        const showNotFound = (query) => {
            foodQuery.textContent = `No results for "${query}"`;
            caloriesValue.textContent = '--';
            proteinValue.textContent = '--';
            verifiedBadge.style.display = 'none';
            resultsCard.style.display = 'block';
        };

        const debouncedSearch = debounce(handleSearch, 500);

        searchInput.addEventListener('input', debouncedSearch);
        portionInput.addEventListener('input', debouncedSearch);
    </script>

</body>
</html>
